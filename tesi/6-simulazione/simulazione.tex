% this file is called up by thesis.tex
% content in this file will be fed into the main document

%: ----------------------- name of chapter  -------------------------
\chapter{Simulations and results}\label{simulazione} % top level followed by section, subsection


%: ----------------------- paths to graphics ------------------------

% change according to folder and file names
%\graphicspath{{2-Consorzi/images/}}


%: ----------------------- contents from here ------------------------
In previous chapters we focused on the concepts, related technologies and implementation realized of the protocol, M2MShare, subject of the study of this thesis. In this section we'll describe the simulations executed and analysis with relative results. For every type of analysis we'll describe the related simulations, the configuration of the simulated world and the other protocols compared to our M2MShare. Finally, for every analysis, we'll show the results in a graphical way with a textual interpretation.
\\

We repeat each of the simulation scenarios several times in order to achieve more accurate results, independent of the initial positioning of the requester peer in search for that particular data file and independent of the initial positioning of the searched file copies. Each scenario is run using a different random seeds to initialize the movement model and for every seed the simulation is repeated using the three compared protocols.

Before proceeding further, we introduce the reader to the adopted terminology and some "must know" configuration parameters:
\begin{itemize}
\item \textit{Population}: refers to the number of nodes in the simulation which emulate people operating M2MShare. This number don't include nodes which emulate public transport, like buses or trams. People are distributed in districts of the map, described in Section \ref{mappaONE}.

\item \textit{File size}: refers to the size of the data file the user is looking for in the simulation 

\item \textit{File popularity}: refers to how many copies of the data file the user is looking for in the simulation are present at the beginning of the simulation. Nodes initially carrying the file are randomly chosen, using the DTNFileGenerator described in Section \ref{fileGeneratorImplementazione} and can be uniformly chosen between all the active nodes or in a subset of them.

\item \textit{Delegation Type}: refers to the type of delegation used in the group of simulations. It can be of three types:
\begin{itemize}
\item \textbf{No\_delegation:} do not use delegation and file exchange is initiated only when a peer holding the requested data file is found in reach area 
\item \textbf{M2MShare:} use the M2MShare technique where missing tasks are delegated only to peers which exceed the \textit{frequencyThreshold} value
\item \textbf{Delegation\_to\_all:} use the trivial technique where missing tasks are delegated to each encountered peer
\end{itemize}

\item \textit{Delegation Depth}: how many times a delegated task can be re-delegate to other peers.

\item \textit{File Division Strategy}: refers to the type of file division strategy used during file transfer between nodes. It can be of three types:
\begin{itemize}
\item \textbf{M2MShare:} use the M2MShare technique to choose the initial download point in the requested file
\item \textbf{iM:} for every file transfer is requested the entire file
\item \textbf{rM:} randomly choose the initial download point in the requested file
\end{itemize}

\item \textit{Nr. of simulations}: how many times the simulation has been repeated with different movement and file generation seeds.

\item \textit{Simulated time}: the simulated length of simulations

\end{itemize}

\newpage
\section{Delegation efficiency}
\label{analisiDelegationEfficiency}
In this analysis we evaluate the efficiency in using delegation versus not using it. Simulations configuration are shown in the following table:
\begin{table}[h]
\begin{center}
\begin{tabular}{|l|r|}
\hline
\bfseries Population & 1000 \\
\hline
\bfseries File size & 3.0 MB \\
\hline
\bfseries File popularity & 50 copies uniformly chosen \\
\hline
\bfseries Delegation type & No\_delegation, M2MShare, Delegation\_to\_all \\
\hline
\bfseries Delegation depth & 1 \\
\hline
\bfseries File Division Strategy & M2MShare \\
\hline
\bfseries Nr. of simulations & 40 x 3\\
\hline
\bfseries Simulated time & One week \\
\hline
\end{tabular}
\end{center}
\end{table}

We compare the efficiency of our system (M2MShare) employing delegations against two other systems using different strategies:
\begin{itemize}
\item \textit{No\_delegation:} system which does not employ delegations and file exchange is initiated only when a peer holding the requested data file is found in reach area of file requester.
\item \textit{Delegation\_to\_all:} system employing delegations but instead employs the trivial technique where missing tasks are delegated to each encountered peer.
\end{itemize}

The metric we study is the found time (Ft) for a generic data file which is the time interval between the first delegation made and the time an output return for that specific file is
received. If no delegations are made and the first file request is satisfied by a direct file possessor the Ft is equal to zero. For each of the above scenarios we also measure the:
\begin{itemize}
\item number of delegations used: representing the number of tasks the requester peer has delegated for that particular data download;
\item percentage of completed task: representing the number of delegated tasks completed (output returned) over all delegated tasks;
\item total data transferred: referring to the quantity of data traffic exchanged between servant peers trying to satisfy a delegated task, file possessor peers and the data forwarding quantity toward the requester node.
\end{itemize}

\begin{figure}[ht]
\begin{minipage}[b]{0.5\linewidth}
\centering
\includegraphics[scale=0.5]{grafici/tempi.eps}
\caption{Average, min. max found time employed by each strategy in finding the required data file.}
\label{graficoTempiVF}
\end{minipage}
\hspace{0.5cm}
\begin{minipage}[b]{0.5\linewidth}
\centering
\includegraphics[scale=0.5]{grafici/delegheFatte.eps}
\caption{Average, min, max number of delegations employed by each delegation strategy.}
\label{graficoNumeroDeleghe}
\end{minipage}
\end{figure}


In Fig.\ref{graficoTempiVF} it is possible to see the advantage, in terms of found time, in using the delegation technique instead of not using it. The two systems employing delegations find the required file in less time in each simulation run at the expense of higher overhead in terms of bandwidth due to delegations. The system employing delegations to all encountered peers gets a better result on average, but at a cost of a higher number of delegated tasks (Fig.\ref{graficoNumeroDeleghe}). A higher number of delegated tasks imply more bandwidth used for searching the data file and potentially retrieving (if found) and forwarding it toward the requester.
\\

Fig.\ref{graficoNumeroDeleghe} makes a comparison between the two systems employing delegations by showing the number of overall employed task delegations till file download or simulation time expires. It is easy to see that M2MShare uses fewer delegations while achieving a higher percentage of completed delegated tasks (Fig. \ref{graficoPercDelegheRitornate}). This outcome is due to a conservative delegation strategy employed by M2MShare in delegating unsatisfied, unaccomplished tasks only to frequently encountered peers
(servants). Since we do not have any means to evaluate the ability of one servant to satisfy a file request what we do is delegate to encountered peers whom is expected to be encountered again in the future. The Delegation\_to\_all strategy contributes to higher overhead also due to completed tasks, ready to be returned toward the requester that unfortunately expire and are discarded before having the chance of encountering the data file requester.
\\

\begin{figure}[ht]
\begin{minipage}[b]{0.5\linewidth}
\centering
\includegraphics[scale=0.5]{grafici/percDeleghe.eps}
\caption{Percentage of completed previously delegated tasks against the number of overall delegations employed.}
\label{graficoPercDelegheRitornate}
\end{minipage}
\hspace{0.5cm}
\begin{minipage}[b]{0.5\linewidth}
\centering
\includegraphics[scale=0.5]{grafici/data.eps}
\caption{Average, min, max transferred data amount employed in each delegations technique.}
\label{graficoDataDiverseDel}
\end{minipage}
\end{figure}


In Fig.\ref{graficoDataDiverseDel} is shown the comparison between M2MShare and Delegation\_to\_all strategies in terms of transferred data quantities till file download or simulation time ends. It is straightforward to notice the higher overhead in terms of data transmissions introduced by delegating to all encountered peers whether M2MShare reduces the exchanged data quantity while still achieving the goal of acquiring the requested file. From the above results it is obvious that the delegation strategy serves its purpose by extending a peer reach area to other mobile disconnected networks where data content might be available therefore reducing the found time of a desired content.
Although this strategy introduces an overhead in terms of bandwidth usage, computation and power consumption we control these side effects by delegating only to frequently encountered peers whom are expected to be encountered again in the future.



\newpage 
\section{Delegation efficiency with variable file popularity}
In previous analysis we show the advantage, in terms of found time of the searched file, using M2MShare delegation strategy against avoid using delegation or delegate unaccomplished tasks to every meet node. The confrontation was made using a constant number of copies of the searched multimedia file uniformly distributed between all nodes in the simulation, i.e. 50 copies. The current analysis want to show the difference in performance using the three delegation strategies changing the initial file popularity of the searched file. To this aim, in these simulations we change the File popularity (Fp) of the multimedia file keeping constant the number of total nodes (N).
These are the settings used for the simulations:
\begin{table}[h]
\begin{center}
\begin{tabular}{|l|r|}
\hline
\bfseries Population & 1000 \\
\hline
\bfseries File size & 3.0 MB \\
\hline
\bfseries File popularity & 50, 100, 150, 200, 250, 300, 350, 400 copies \\
\hline
\bfseries Delegation type & No\_delegation, M2MShare, Delegation\_to\_all \\
\hline
\bfseries Delegation depth & 1 \\
\hline
\bfseries File Division Strategy & M2MShare \\
\hline
\bfseries Nr. of simulations & 40 x 8 x 3\\
\hline
\bfseries Simulated time & 48 hours \\
\hline
\end{tabular}
\end{center}
\end{table}
We change the File Popularity (Fp) value, from 5\% (50 copies) to 40\% (400 copies). When the Fp is low (with Fp £ 5\%) the system which don't use delegation is not able to find any piece of the file during the simulation time. We have indicated this in the chart by assigning to Ftavg a value of 48 h. With higher values of Fp, the first protocol is able to find the file thanks to the higher popularity of the requested file, but it takes more time than M2MShare and Delegation\_to\_all. Finally, with the highest values of Fp the performances of the three compared systems became very similar. 
\begin{figure}[ht]
  \begin{center}
    \includegraphics[scale=0.5]{grafici/percDeleghe.eps}
    \caption{Percentage of completed previously delegated tasks against the number of overall delegations employed.}
    \label{graficoPopVariabile}
  \end{center}
\end{figure}


\newpage
\section{Delegation efficiency with variable nodes population}
In previous analysis we considered as constant the number of nodes emulating people using M2MShare on their devices. In the current analysis we changed the total population of the simulations, observing how this affects the performance of compared systems.
\begin{table}[h]
\begin{center}
\begin{tabular}{|l|r|}
\hline
\bfseries Population & 100, 200, 400, 600, 800, 1000 \\
\hline
\bfseries File size & 3.0 MB \\
\hline
\bfseries File popularity & 5\%, 10\%, 50\% \\
\hline
\bfseries Delegation type & No\_delegation, M2MShare, Delegation\_to\_all \\
\hline
\bfseries Delegation depth & 1 \\
\hline
\bfseries File Division Strategy & M2MShare \\
\hline
\bfseries Nr. of simulations & 40 x 6 x 3 x 3\\
\hline
\bfseries Simulated time & 48 hours \\
\hline
\end{tabular}
\end{center}
\end{table}

In the first scenario (Fig.\ref{graficiTempiVF_Fp5}) we consider Fp = 5\%. The protocol not employing delegations (black line in the chart) is not able to find any piece of the file during the simulation time when the considered nodes in the scenario are equal or less than 400. We have indicated this in the chart by assigning to Ftavg a value of 48 h. This is due to the trivial strategy employed by the protocol and to the sparse environment. Even when able to find some node possessing the file (with $N \geq 600$), the time needed results bigger than using a strategy implementing delegations. Clearly, when increasing the file population (Fp), even the number of nodes in the population that posses the data file increases; as a result, the time to retrieve the file decreases for all solutions. A similar result is achieved also when considering a wider popularity for the required multimedia file (Fp = 10\%, in Fig.\ref{graficiTempiVF_Fp10}). However, in this case, the higher popularity of the requested file helps both solutions in finding the file possessor with a smaller Ftavg than in the previous scenario.  Finally, in Fig.\ref{graficiTempiVF_Fp50}, the performances of the compared solutions are very similar. This is due to the high file popularity among nodes (Fp = 50\%): the chances of eventually finding a file possessor in a short time are clearly much higher.

\begin{figure}[ht]
\begin{minipage}[b]{0.5\linewidth}
\centering
\includegraphics[scale=0.5]{grafici/percDeleghe.eps}
\caption{Average found time with $Fp = 5\%$}
\label{graficiTempiVF_Fp5}
\end{minipage}
\hspace{0.5cm}
\begin{minipage}[b]{0.5\linewidth}
\centering
\includegraphics[scale=0.5]{grafici/data.eps}
\caption{Average found time with $Fp = 10\%$}
\label{graficiTempiVF_Fp10}
\end{minipage}
\hspace{0.5cm}
\begin{center}
\begin{minipage}[b]{0.5\linewidth}
\centering
\includegraphics[scale=0.5]{grafici/data.eps}
\caption{Average found time with $Fp = 50\%$}
\label{graficiTempiVF_Fp50}
\end{minipage}
\end{center}
\end{figure}


\newpage
\section{Data redundancy}
In analysis in Section \ref{analisiDelegationEfficiency}, especially in Fig. \ref{graficoDataDiverseDel}, we show that our system is the most efficient with respect to data transmissions. Although using delegations introduces an overhead in terms of bandwidth usage we control this side effects by delegating only to frequently encountered peers whom are expected to be encountered again in the future. Another side effect caused by delegating tasks is the increasing of data redundancy in the whole network. For \textit{redundancy}, in this case, we mean storage space used in nodes involved in delegation system. \\ These are the settings used in simulations related to the study of this metric:

\begin{table}[h]
\begin{center}
\begin{tabular}{|l|r|}
\hline
\bfseries Population & 1000 \\
\hline
\bfseries File size & 3.0 MB \\
\hline
\bfseries File popularity & 50 copies uniformly chosen \\
\hline
\bfseries Delegation type & M2MShare, Delegation\_to\_all \\
\hline
\bfseries Delegation depth & 1 \\
\hline
\bfseries File Division Strategy & M2MShare \\
\hline
\bfseries Nr. of simulations & 40 x 2\\
\hline
\bfseries Simulated time & One week \\
\hline
\end{tabular}
\end{center}
\end{table}

Of course redundancy in a network composed only by nodes which don't use delegation is always zero. For this reason we compared for this study only the two systems which use task delegations. In Fig.\ref{graficoRidondanzaData} we show how change the average data redundancy during the progress of simulations. It is straightforward to notice the higher value introduced by delegating to all encountered peers whether M2MShare reduces the data redundancy quantity while still achieving the goal of acquiring the requested file. This is due to the number of contemporary active delegated tasks, shown in Fig.\ref{graficoDelegheAttive}, which is higher in the system which delegates task to all encounter nodes.

\begin{figure}[ht]
\begin{minipage}[b]{0.5\linewidth}
\centering
\includegraphics[scale=0.5]{grafici/percDeleghe.eps}
\caption{Average found time with $Fp = 5\%$}
\label{graficoRidondanzaData}
\end{minipage}
\hspace{0.5cm}
\begin{minipage}[b]{0.5\linewidth}
\centering
\includegraphics[scale=0.5]{grafici/data.eps}
\caption{Average found time with $Fp = 10\%$}
\label{graficoDelegheAttive}
\end{minipage}
\end{figure}

\newpage 
\section{File Division Strategy efficency}
In previous analysis we evaluate the efficiency of M2MShare delegation technique, but in the protocol the delegation system is not the only new innovation described. M2MShare provides a new file division strategy, described in Section \ref{descrFileDivisionStrategy}, where a file can be downloaded in pieces and a piece size varies. That file division strategy might add redundancy during data transfer as it can happen that overlapping data intervals are simultaneously downloaded by different servants. However, the fact that each servant is asked to download the file starting from different points allows reconstructing the whole file even if both downloaded just part of it. \\
In this analysis we compare our file division strategy with two other division strategies:
\begin{itemize}
\item iM: a strategy which requests at each file server the
entire file, always starting from its first byte;
\item rM: a strategy that randomly chooses the initial
download point in the file request.
\end{itemize}
These are the settings of the related simulations:
\begin{table}[h]
\begin{center}
\begin{tabular}{|l|r|}
\hline
\bfseries Population & 1000 \\
\hline
\bfseries File size & 3.0 MB, 10.0 MB, 25.0 MB \\
\hline
\bfseries File popularity & 50 copies uniformly chosen \\
\hline
\bfseries Delegation type & M2MShare \\
\hline
\bfseries Delegation depth & 1 \\
\hline
\bfseries File Division Strategy & M2MShare, iM , rM \\
\hline
\bfseries Nr. of simulations & 40 x 3 x 3\\
\hline
\bfseries Simulated time & One week \\
\hline
\end{tabular}
\end{center}
\end{table}

We considered the average, min and max transferred data amount employed in each file division strategy. We repeated the simulations 40 times, changing random seeds, for every file division strategy in order to achieve more accurate results and we did this using three different sizes of the searched file. 
\\
In earlier studies some test were done to evaluate the efficiency of M2MShare file division strategy, but task delegation was not considered because simulated scenarios did not take into consideration disconnections due to mobility or interferences that happen in real world
communication. That has only been possible with the current implementation of the protocol, in a network simulation environment which can simulate movement of nodes emulating people using M2MShare.
As we can see from the graphics below our division strategy has the least redundancy during data transfer, especially considering big-sized files.

\begin{figure}[htpb]
  \begin{center}
    \includegraphics[scale=1]{grafici/dataDFS_3MB.eps}
    \caption{Average, min, max transferred data amount using different file division strategies and 3.0 MB file size.}
    \label{graficoDataFDS_3MB}
  \end{center}
\end{figure}

\begin{figure}[htpb]
  \begin{center}
    \includegraphics[scale=1]{grafici/dataDFS_10MB.eps}
    \caption{Average, min, max transferred data amount using different file division strategies and 10.0 MB file size.}
    \label{graficoDataFDS_10MB}
  \end{center}
\end{figure}

\begin{figure}[htpb]
  \begin{center}
    \includegraphics[scale=1]{grafici/dataDFS_25MB.eps}
    \caption{Average, min, max transferred data amount using different file division strategies and 25.0 MB file size.}
    \label{graficoDataFDS_25MB}
  \end{center}
\end{figure}

%\label{analisiLabel}
 
% ---------------------------------------------------------------------------
%: ----------------------- end of thesis sub-document ------------------------
% ---------------------------------------------------------------------------

